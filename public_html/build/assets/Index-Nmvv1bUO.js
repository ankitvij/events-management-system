import{u as y,G as f,j as e,H as j}from"./app-B1OVwYjf.js";import{A as v,T as N}from"./app-layout-Bx9T6CMa.js";/* empty css            */import"./button-BQnUYNhc.js";import"./index-0YzzMj2p.js";import"./index-U_inQz34.js";import"./index-BDqSilVs.js";function u(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}function q(){const i=y(),a=i.props?.cart?.items??[],r=i.props?.cart_total??0,n=i.props?.cart_count??a.reduce((t,s)=>t+(s.quantity||0),0),[o,x]=f.useState({items:p(a),total:r,count:n});async function m(){try{const t=await fetch("/cart/summary",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!t.ok)return;const s=await t.json();x({items:p(s.items??[]),total:s.total??0,count:s.count??0})}catch{}}async function l(t,s){try{const d=u();(await fetch(`/cart/items/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":d},credentials:"same-origin",body:JSON.stringify({quantity:s})})).ok&&(window.dispatchEvent(new CustomEvent("cart:updated")),await m())}catch{}}async function h(t){try{const s=u();(await fetch(`/cart/items/${t}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":s},credentials:"same-origin"})).ok&&(window.dispatchEvent(new CustomEvent("cart:updated")),await m())}catch{}}return e.jsxs(v,{children:[e.jsx(j,{children:e.jsx("title",{children:"Your Cart"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Shopping Cart"}),o.items&&o.items.length>0?e.jsx("div",{className:"mt-4 space-y-2",children:o.items.map(t=>e.jsxs("div",{className:"border p-2 rounded flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.ticket?t.ticket.name:t.ticket_id?`Ticket #${t.ticket_id}`:"Item"}),e.jsx("div",{className:"text-sm text-muted",children:t.event?`Event: ${t.event.title}`:""}),e.jsxs("div",{className:"text-sm text-muted",children:["Qty: ",t.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["€",Number(t.price).toFixed(2)]}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>l(t.id,Math.max(1,t.quantity-1)),children:"-"}),e.jsx("div",{className:"px-2",children:t.quantity}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>l(t.id,t.quantity+1),children:"+"}),e.jsx("button",{type:"button","aria-label":"Delete item",className:"ml-3 text-red-600 p-1 rounded hover:bg-red-50",onClick:()=>h(t.id),children:e.jsx(N,{className:"h-4 w-4"})})]})]})]},t.id??`${t.ticket_id}_${t.event_id}`))}):e.jsx("div",{className:"text-sm text-muted mt-4",children:"Your cart is empty."}),e.jsx("div",{className:"mt-4 p-4 border-t text-right",children:e.jsxs("div",{className:"text-lg font-medium",children:["Total: €",Number(o.total).toFixed(2)]})})]})]})}function p(i){const c=new Map;for(const a of i){const r=`${a.ticket_id??"t"}:${a.event_id??"e"}`;if(!c.has(r))c.set(r,{...a});else{const n=c.get(r);n.quantity=(n.quantity||0)+(a.quantity||0),n.price=a.price??n.price}}return Array.from(c.values())}export{q as default};

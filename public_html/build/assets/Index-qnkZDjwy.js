import{u as v,G as p,j as e,H as N}from"./app-BBhRT0BT.js";import{A as k,T as b,C as g}from"./app-layout-pbUr-j7-.js";/* empty css            */import"./button-DSSG-NsU.js";import"./index-D4P6CcNm.js";import"./index-gdzwEDWp.js";import"./index-BDqSilVs.js";function h(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}function A(){const i=v(),a=i.props?.cart?.items??[],o=i.props?.cart_total??0,n=i.props?.cart_count??a.reduce((t,s)=>t+(s.quantity||0),0),[r,y]=p.useState({items:x(a),total:o,count:n});async function d(){try{const t=await fetch("/cart/summary",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!t.ok)return;const s=await t.json();y({items:x(s.items??[]),total:s.total??0,count:s.count??0})}catch{}}async function l(t,s){try{const m=h();(await fetch(`/cart/items/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":m},credentials:"same-origin",body:JSON.stringify({quantity:s})})).ok&&(window.dispatchEvent(new CustomEvent("cart:updated")),await d())}catch{}}async function f(t){try{const s=h();(await fetch(`/cart/items/${t}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":s},credentials:"same-origin"})).ok&&(window.dispatchEvent(new CustomEvent("cart:updated")),await d())}catch{}}const[j,u]=p.useState(!1);return e.jsxs(k,{children:[e.jsx(N,{children:e.jsx("title",{children:"Your Cart"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Shopping Cart"}),r.items&&r.items.length>0?e.jsx("div",{className:"mt-4 space-y-2",children:r.items.map(t=>e.jsxs("div",{className:"border p-2 rounded flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.ticket?t.ticket.name:t.ticket_id?`Ticket #${t.ticket_id}`:"Item"}),e.jsx("div",{className:"text-sm text-muted",children:t.event?`Event: ${t.event.title}`:""}),e.jsxs("div",{className:"text-sm text-muted",children:["Qty: ",t.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["€",Number(t.price).toFixed(2)]}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>l(t.id,Math.max(1,t.quantity-1)),children:"-"}),e.jsx("div",{className:"px-2",children:t.quantity}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>l(t.id,t.quantity+1),children:"+"}),e.jsx("button",{type:"button","aria-label":"Delete item",className:"ml-3 text-red-600 p-1 rounded hover:bg-red-50",onClick:()=>f(t.id),children:e.jsx(b,{className:"h-4 w-4"})})]})]})]},t.id??`${t.ticket_id}_${t.event_id}`))}):e.jsx("div",{className:"text-sm text-muted mt-4",children:"Your cart is empty."}),e.jsxs("div",{className:"mt-4 p-4 border-t text-right",children:[e.jsxs("div",{className:"text-lg font-medium",children:["Total: €",Number(r.total).toFixed(2)]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("button",{type:"button",onClick:()=>u(!0),className:"ml-2 inline-flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white",children:"Checkout"}),e.jsx(g,{isOpen:j,onClose:()=>u(!1),onSuccess:async()=>{await d()}})]})]})]})]})}function x(i){const c=new Map;for(const a of i){const o=`${a.ticket_id??"t"}:${a.event_id??"e"}`;if(!c.has(o))c.set(o,{...a});else{const n=c.get(o);n.quantity=(n.quantity||0)+(a.quantity||0),n.price=a.price??n.price}}return Array.from(c.values())}export{A as default};

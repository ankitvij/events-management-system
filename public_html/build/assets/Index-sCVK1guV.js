import{u as j,G as y,j as e,H as k}from"./app-B5tVjKGA.js";import{A as v,T as N}from"./app-layout-EdM5Lg98.js";/* empty css            */import"./button-Bz6ta2fw.js";import"./index-CfCbur-y.js";import"./index-5ih_GjRr.js";import"./index-BDqSilVs.js";function l(){return document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""}function S(){const n=j(),a=n.props?.cart?.items??[],o=n.props?.cart_total??0,i=n.props?.cart_count??a.reduce((t,s)=>t+(s.quantity||0),0),[d,x]=y.useState({items:h(a),total:o,count:i});async function m(){try{const t=await fetch("/cart/summary",{headers:{Accept:"application/json"},credentials:"same-origin"});if(!t.ok)return;const s=await t.json();x({items:h(s.items??[]),total:s.total??0,count:s.count??0})}catch{}}async function u(t,s){try{const c=l();(await fetch(`/cart/items/${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-TOKEN":c},credentials:"same-origin",body:JSON.stringify({quantity:s})})).ok&&(window.dispatchEvent(new CustomEvent("cart:updated")),await m())}catch{}}async function f(t){try{const s=l();(await fetch(`/cart/items/${t}`,{method:"DELETE",headers:{Accept:"application/json","X-CSRF-TOKEN":s},credentials:"same-origin"})).ok&&(window.dispatchEvent(new CustomEvent("cart:updated")),await m())}catch{}}return e.jsxs(v,{children:[e.jsx(k,{children:e.jsx("title",{children:"Your Cart"})}),e.jsxs("div",{className:"p-4",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Shopping Cart"}),d.items&&d.items.length>0?e.jsx("div",{className:"mt-4 space-y-2",children:d.items.map(t=>e.jsxs("div",{className:"border p-2 rounded flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:t.ticket?t.ticket.name:t.ticket_id?`Ticket #${t.ticket_id}`:"Item"}),e.jsx("div",{className:"text-sm text-muted",children:t.event?`Event: ${t.event.title}`:""}),e.jsxs("div",{className:"text-sm text-muted",children:["Qty: ",t.quantity]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"font-medium",children:["€",Number(t.price).toFixed(2)]}),e.jsxs("div",{className:"mt-2 flex items-center justify-end gap-2",children:[e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>u(t.id,Math.max(1,t.quantity-1)),children:"-"}),e.jsx("div",{className:"px-2",children:t.quantity}),e.jsx("button",{type:"button",className:"px-2 py-1 border rounded",onClick:()=>u(t.id,t.quantity+1),children:"+"}),e.jsx("button",{type:"button","aria-label":"Delete item",className:"ml-3 text-red-600 p-1 rounded hover:bg-red-50",onClick:()=>f(t.id),children:e.jsx(N,{className:"h-4 w-4"})})]})]})]},t.id??`${t.ticket_id}_${t.event_id}`))}):e.jsx("div",{className:"text-sm text-muted mt-4",children:"Your cart is empty."}),e.jsxs("div",{className:"mt-4 p-4 border-t text-right",children:[e.jsxs("div",{className:"text-lg font-medium",children:["Total: €",Number(d.total).toFixed(2)]}),e.jsx("div",{className:"mt-2",children:e.jsx("button",{type:"button",onClick:async()=>{if(confirm("Proceed to checkout? This will reserve the tickets."))try{const t=l(),s=await fetch("/cart/checkout",{method:"POST",headers:{Accept:"application/json","X-CSRF-TOKEN":t},credentials:"same-origin"});if(!s.ok){const p=await s.json().catch(()=>({message:"Checkout failed"}));alert(p.message||"Checkout failed");return}const c=await s.json();c.success?(alert(c.message||"Checkout complete"),await m()):alert(c.message||"Checkout failed")}catch{alert("Checkout error")}},className:"ml-2 inline-flex items-center gap-2 rounded bg-green-600 px-3 py-2 text-sm text-white",children:"Checkout"})})]})]})]})}function h(n){const r=new Map;for(const a of n){const o=`${a.ticket_id??"t"}:${a.event_id??"e"}`;if(!r.has(o))r.set(o,{...a});else{const i=r.get(o);i.quantity=(i.quantity||0)+(a.quantity||0),i.price=a.price??i.price}}return Array.from(r.values())}export{S as default};
